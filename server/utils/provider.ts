import type { OAuthConfig } from '@auth/core/providers'

export type WikiGroup =
  | '*'
  | 'user'
  | 'autoconfirmed'
  | 'bot'
  | 'sysop'
  | 'bureaucrat'
  | 'autopatrol'
  | 'patrollers'
  | 'interface-admin'
  | 'checkuser'
  | 'global-interface-maintainer'
  | 'staff'
  | 'cats'

export type WikiGrant =
  | 'basic'
  | 'blockusers'
  | 'checkuser'
  | 'createaccount'
  | 'delete'
  | 'editinterface'
  | 'editmycssjs'
  | 'editmyoptions'
  | 'editmywatchlist'
  | 'editpage'
  | 'editprotected'
  | 'editsiteconfig'
  | 'globalblock'
  | 'highvolume'
  | 'import'
  | 'mergehistory'
  | 'oath'
  | 'oversight'
  | 'patrol'
  | 'privateinfo'
  | 'protect'
  | 'rollback'
  | 'sendemail'
  | 'shortenurls'
  | 'uploadfile'
  | 'viewdeleted'
  | 'viewmywatchlist'

export type WikiRight =
  | 'abusefilter-hidden-log'
  | 'abusefilter-hide-log'
  | 'abusefilter-log'
  | 'abusefilter-log-detail'
  | 'abusefilter-log-private'
  | 'abusefilter-modify'
  | 'abusefilter-modify-global'
  | 'abusefilter-modify-restricted'
  | 'abusefilter-privatedetails'
  | 'abusefilter-privatedetails-log'
  | 'abusefilter-revert'
  | 'abusefilter-view'
  | 'ajaxpoll-view-results'
  | 'ajaxpoll-view-results-before-vote'
  | 'ajaxpoll-vote'
  | 'apihighlimits'
  | 'applychangetags'
  | 'autoconfirmed'
  | 'autopatrol'
  | 'bigdelete'
  | 'block'
  | 'blockemail'
  | 'bot'
  | 'browsearchive'
  | 'bypassgloopspam'
  | 'changetags'
  | 'checkuser'
  | 'checkuser-log'
  | 'createaccount'
  | 'createpage'
  | 'createtalk'
  | 'delete'
  | 'deletechangetags'
  | 'deletedhistory'
  | 'deletedtext'
  | 'deletelogentry'
  | 'deleterevision'
  | 'directoreditprotected'
  | 'dpl_param_delete_rules'
  | 'dpl_param_update_rules'
  | 'edit'
  | 'editcontentmodel'
  | 'editinterface'
  | 'editinterfacesite'
  | 'editmyoptions'
  | 'editmyprivateinfo'
  | 'editmyusercss'
  | 'editmyuserjs'
  | 'editmyuserjson'
  | 'editmyuserjsredirect'
  | 'editmywatchlist'
  | 'editprotected'
  | 'editsemiprotected'
  | 'editsitecss'
  | 'editsitejs'
  | 'editsitejson'
  | 'editstaff'
  | 'editusercss'
  | 'edituserjs'
  | 'edituserjson'
  | 'globalblock'
  | 'globalblock-whitelist'
  | 'gloopcontrol'
  | 'hideuser'
  | 'import'
  | 'importupload'
  | 'ipblock-exempt'
  | 'managechangetags'
  | 'markbotedits'
  | 'mergehistory'
  | 'minoredit'
  | 'move'
  | 'move-categorypages'
  | 'move-rootuserpages'
  | 'move-subpages'
  | 'movefile'
  | 'mwoauthmanageconsumer'
  | 'mwoauthmanagemygrants'
  | 'mwoauthproposeconsumer'
  | 'mwoauthsuppress'
  | 'mwoauthupdateownconsumer'
  | 'mwoauthviewprivate'
  | 'mwoauthviewsuppressed'
  | 'nominornewtalk'
  | 'noratelimit'
  | 'oathauth-enable'
  | 'override-antispoof'
  | 'override-export-depth'
  | 'pagelang'
  | 'patrol'
  | 'patrolmarks'
  | 'protect'
  | 'protectsite'
  | 'purge'
  | 'read'
  | 'renameuser'
  | 'reupload'
  | 'reupload-own'
  | 'reupload-shared'
  | 'rollback'
  | 'searchdigest-admin'
  | 'searchdigest-block'
  | 'searchdigest-reader'
  | 'searchdigest-reader-stats'
  | 'sendemail'
  | 'siteadmin'
  | 'skipcaptcha'
  | 'smw-admin'
  | 'smw-pageedit'
  | 'smw-patternedit'
  | 'smw-vieweditpageinfo'
  | 'spamblacklistlog'
  | 'suppressionlog'
  | 'suppressredirect'
  | 'suppressrevision'
  | 'tboverride'
  | 'titleblacklistlog'
  | 'torunblocked'
  | 'transcode-reset'
  | 'transcode-status'
  | 'unblockself'
  | 'undelete'
  | 'unwatchedpages'
  | 'upload'
  | 'upload_by_url'
  | 'usermerge'
  | 'userrights'
  | 'userrights-global'
  | 'userrights-interwiki'
  | 'viewmyprivateinfo'
  | 'viewmywatchlist'
  | 'writeapi'

export interface WikiProfile extends Record<string, any> {
  sub: string
  username: string
  editcount: number
  confirmed_email: boolean
  blocked: boolean
  registered: string
  groups: WikiGroup[]
  rights: WikiRight[]
  grants: WikiGrant[]
  realname: string
  email: string
}

export default function ZhMinecraftWiki<P extends WikiProfile>(): OAuthConfig<P> {
  return {
    id: 'minecraftwiki',
    name: 'ZH Minecraft Wiki',
    type: 'oauth',
    token: 'https://preview-wiki.bedev.cn/w/rest.php/oauth2/access_token',
    userinfo: 'https://preview-wiki.bedev.cn/w/rest.php/oauth2/resource/profile',
    authorization: 'https://preview-wiki.bedev.cn/w/rest.php/oauth2/authorize?scope=',
    profile(profile) {
      return {
        id: profile.sub,
        name: profile.username,
        email: profile.email,
        image: null,
      }
    },
    clientId: useRuntimeConfig().clientId,
    clientSecret: useRuntimeConfig().clientSecret,
  }
}
